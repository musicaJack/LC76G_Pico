# GPS仪表盘功能说明

## 功能概述

GPS仪表盘是一个高科技风格的显示界面，包含两个主要功能：

1. **GPS信息显示阶段**：初始显示GPS详细信息1分钟
2. **仪表盘显示阶段**：自动切换到高科技仪表盘界面

## 界面设计

### 1. GPS信息显示阶段
```
┌─────────────────────────────────────────────────────────┐
│                GPS Position Monitor                     │
│                                                         │
│  Latitude:  39.123456                                  │
│  Longitude: 116.654321                                 │
│  Speed:     12.5 km/h                                  │
│  Course:    180.5°                                     │
│  Time:      14:30:25                                   │
│                                                         │
│              切换到仪表盘: 45秒                         │
└─────────────────────────────────────────────────────────┘
```

### 2. 仪表盘显示阶段
```
┌─────────────────────────────────────────────────────────┐
│                                                         │
│  ┌─────────────────┐    ┌─────────┐    ┌─────────────────┐ │
│  │                 │    │         │    │                 │ │
│  │   罗盘仪表盘     │    │ 14:30   │    │   速度仪表盘     │ │
│  │   (Compass)     │    │         │    │  (Speedometer)  │ │
│  │                 │    │         │    │                 │ │
│  │       N         │    │         │    │      0          │ │
│  │   W  +  E       │    │         │    │    ┌─────┐     │ │
│  │       S         │    │         │    │    │ 45   │     │ │
│  │                 │    │         │    │    │ km/h │     │ │
│  └─────────────────┘    └─────────┘    └─────────────────┘ │
│                                                         │
│  ┌─────────────────────────────────────────────────────┐ │
│  │  GPS: 已定位 | 卫星: 8颗 | 运行: 02:15             │ │
│  └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

## 主要功能

### 1. 罗盘仪表盘（左侧）
- **功能**：显示当前朝向方向
- **样式**：圆形仪表盘，高科技蓝色主题
- **内容**：
  - 外圈：8个方向刻度（N, NE, E, SE, S, SW, W, NW）
  - 内圈：数字角度刻度（0°, 45°, 90°, 135°, 180°, 225°, 270°, 315°）
  - 中心：方向指针，实时指向当前朝向
  - 底部：当前角度数字显示

### 2. 速度仪表盘（右侧）
- **功能**：显示当前移动速度
- **样式**：圆形仪表盘，高科技绿色主题
- **内容**：
  - 外圈：速度刻度（0, 20, 40, 60, 80, 100, 120 km/h）
  - 内圈：数字刻度
  - 中心：速度指针，实时显示当前速度
  - 底部：当前速度数字显示

### 3. 时间显示（中央）
- **功能**：显示24小时制时间
- **样式**：数字时钟，蓝色边框
- **更新**：实时更新，显示GPS时间

### 4. 状态信息栏（底部）
- **GPS状态**：已定位/未定位
- **卫星数量**：当前连接的卫星数量
- **运行时间**：系统运行时间

## 自动切换逻辑

### 切换条件
1. GPS模块成功定位（Status = 1）
2. 获得有效坐标数据（纬度、经度不为0）
3. 定位成功后持续1分钟

### 切换过程
1. **计时开始**：GPS定位成功后开始计时
2. **倒计时显示**：在GPS信息界面显示剩余时间
3. **自动切换**：1分钟后自动切换到仪表盘界面
4. **界面刷新**：切换时清屏并重新绘制

## 技术特性

### 1. 实时更新
- GPS数据：每秒更新
- 显示刷新：10Hz（100ms间隔）
- 指针动画：平滑过渡

### 2. 颜色方案
- **背景**：深黑色 (#000000)
- **仪表盘**：深蓝色 (#001122) + 蓝色 (#003366)
- **刻度线**：青色 (#00FFFF)
- **罗盘指针**：亮蓝色 (#0088FF)
- **速度指针**：绿色 (#00FF00)
- **文字**：白色 (#FFFFFF)

### 3. 数学计算
- **极坐标转换**：将角度转换为屏幕坐标
- **指针位置**：实时计算指针端点坐标
- **角度限制**：速度表指针限制在-90°到90°范围

### 4. 性能优化
- **局部刷新**：只更新变化的数据
- **状态缓存**：避免重复绘制
- **平滑动画**：指针移动使用缓动

## 使用方法

### 1. 编译
```bash
mkdir build
cd build
cmake ..
make vendor_gps_dashboard
```

### 2. 烧录
```bash
# 将生成的.uf2文件复制到Pico
cp vendor_gps_dashboard.uf2 /path/to/Pico/
```

### 3. 运行
1. 连接GPS模块和ILI9488显示屏
2. 上电启动
3. 等待GPS定位
4. 观察界面自动切换

## 硬件要求

### GPS模块
- L76X系列GPS模块
- UART连接（115200波特率）
- 天线连接

### 显示屏
- ILI9488 3.5寸显示屏
- SPI连接
- 480×320分辨率

### 引脚连接
- GPS: GPIO0(TX), GPIO1(RX), GPIO4(FORCE)
- 显示屏: GPIO15(RST), GPIO16(BL), GPIO17(CS), GPIO18(SCK), GPIO19(MOSI), GPIO20(DC)

## 故障排除

### 1. GPS无法定位
- 检查GPS模块连接
- 确认天线连接
- 检查GPS模块供电
- 等待足够时间（首次定位可能需要几分钟）

### 2. 显示异常
- 检查SPI连接
- 确认背光引脚配置
- 验证电源供应

### 3. 界面不切换
- 确认GPS定位成功
- 检查时间计算逻辑
- 查看调试输出

## 扩展功能

### 可能的改进
1. 添加触摸屏支持
2. 实现更多仪表盘样式
3. 添加数据记录功能
4. 支持多语言界面
5. 添加声音提示
6. 实现夜间模式

### 自定义选项
1. 修改颜色方案
2. 调整仪表盘大小
3. 更改切换时间
4. 添加更多状态信息
